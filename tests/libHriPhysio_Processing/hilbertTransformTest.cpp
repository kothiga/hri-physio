/* ================================================================================
 * Copyright: (C) 2021, SIRRL Social and Intelligent Robotics Research Laboratory, 
 *     University of Waterloo, All rights reserved.
 * 
 * Authors: 
 *     Austin Kothig <austin.kothig@uwaterloo.ca>
 * 
 * CopyPolicy: Released under the terms of the BSD 3-Clause License. 
 *     See the accompanying LICENSE file for details.
 * ================================================================================
 */

#include <doctest.h>

#include <HriPhysio/Processing/hilbertTransform.h>

#define DEBUG 0


//-- Prototypes. Implemented in processingHelperFunctions.cpp.
void printVector(const std::vector<double>& vec);
double absError(const std::vector<double>& vec1, const std::vector<double>& vec2);


TEST_CASE("Test a simple sinusoidal wave (1 second of a 18 Hz wave at 256 Hz sampling rate)") {

    std::size_t num_samples = 256;
    
    std::vector<double> source = {
        0.0,0.42755508,0.77301043,0.97003126,0.98078525,0.8032075,0.47139674,0.049067676,-0.38268343,-0.7409511,-0.95694035,-0.9891765,-0.8314696,-0.51410276,-0.09801714,0.33688986,
        0.70710677,0.94154406,0.9951847,0.8577286,0.55557024,0.14673047,-0.29028466,-0.671559,-0.9238795,-0.99879545,-0.8819213,-0.5956993,-0.19509032,0.24298018,0.6343933,0.9039893,
        1.0,0.9039893,0.6343933,0.24298018,-0.19509032,-0.5956993,-0.8819213,-0.99879545,-0.9238795,-0.671559,-0.29028466,0.14673047,0.55557024,0.8577286,0.9951847,0.94154406,
        0.70710677,0.33688986,-0.09801714,-0.51410276,-0.8314696,-0.9891765,-0.95694035,-0.7409511,-0.38268343,0.049067676,0.47139674,0.8032075,0.98078525,0.97003126,0.77301043,0.42755508,
        1.1021821e-15,-0.42755508,-0.77301043,-0.97003126,-0.98078525,-0.8032075,-0.47139674,-0.049067676,0.38268343,0.7409511,0.95694035,0.9891765,0.8314696,0.51410276,0.09801714,-0.33688986,
        -0.70710677,-0.94154406,-0.9951847,-0.8577286,-0.55557024,-0.14673047,0.29028466,0.671559,0.9238795,0.99879545,0.8819213,0.5956993,0.19509032,-0.24298018,-0.6343933,-0.9039893,
        -1.0,-0.9039893,-0.6343933,-0.24298018,0.19509032,0.5956993,0.8819213,0.99879545,0.9238795,0.671559,0.29028466,-0.14673047,-0.55557024,-0.8577286,-0.9951847,-0.94154406,
        -0.70710677,-0.33688986,0.09801714,0.51410276,0.8314696,0.9891765,0.95694035,0.7409511,0.38268343,-0.049067676,-0.47139674,-0.8032075,-0.98078525,-0.97003126,-0.77301043,-0.42755508,
        -2.2043643e-15,0.42755508,0.77301043,0.97003126,0.98078525,0.8032075,0.47139674,0.049067676,-0.38268343,-0.7409511,-0.95694035,-0.9891765,-0.8314696,-0.51410276,-0.09801714,0.33688986,
        0.70710677,0.94154406,0.9951847,0.8577286,0.55557024,0.14673047,-0.29028466,-0.671559,-0.9238795,-0.99879545,-0.8819213,-0.5956993,-0.19509032,0.24298018,0.6343933,0.9039893,
        1.0,0.9039893,0.6343933,0.24298018,-0.19509032,-0.5956993,-0.8819213,-0.99879545,-0.9238795,-0.671559,-0.29028466,0.14673047,0.55557024,0.8577286,0.9951847,0.94154406,
        0.70710677,0.33688986,-0.09801714,-0.51410276,-0.8314696,-0.9891765,-0.95694035,-0.7409511,-0.38268343,0.049067676,0.47139674,0.8032075,0.98078525,0.97003126,0.77301043,0.42755508,
        6.85926e-15,-0.42755508,-0.77301043,-0.97003126,-0.98078525,-0.8032075,-0.47139674,-0.049067676,0.38268343,0.7409511,0.95694035,0.9891765,0.8314696,0.51410276,0.09801714,-0.33688986,
        -0.70710677,-0.94154406,-0.9951847,-0.8577286,-0.55557024,-0.14673047,0.29028466,0.671559,0.9238795,0.99879545,0.8819213,0.5956993,0.19509032,-0.24298018,-0.6343933,-0.9039893,
        -1.0,-0.9039893,-0.6343933,-0.24298018,0.19509032,0.5956993,0.8819213,0.99879545,0.9238795,0.671559,0.29028466,-0.14673047,-0.55557024,-0.8577286,-0.9951847,-0.94154406,
        -0.70710677,-0.33688986,0.09801714,0.51410276,0.8314696,0.9891765,0.95694035,0.7409511,0.38268343,-0.049067676,-0.47139674,-0.8032075,-0.98078525,-0.97003126,-0.77301043,-0.42755508
    };

    std::vector<double> expected = {
        1.0000000526438808,0.9999999537865419,0.9999999596688989,1.0000000262469595,0.9999999755140272,1.0000000138526777,1.0000000226210015,0.9999999706640359,1.0000000543339909,0.9999999798522196,0.9999999189934995,1.0000000277361134,1.0000000036021524,1.0000000045412236,1.00000002070909,1.000000031372263,
        1.0000000584386899,1.000000000940587,0.9999999352600194,0.9999999765274582,1.000000054058591,0.9999999878085359,1.0000000254875285,1.0000000544877887,0.9999999919008907,1.0000000169345378,0.9999999251940851,0.999999994017511,1.000000045902538,0.9999998903699862,0.9999999356988397,1.0000000428341875,
        1.0000001192092924,1.0000000883945679,0.9999999927264464,1.000000000829327,1.000000017575584,0.9999999835606816,0.9999999566247212,1.0000000297860503,1.0000000486727265,1.0000000400125997,1.0000000268774825,0.9999999968054444,1.0000000386345658,0.9999999655367796,0.9999999158656391,0.9999999910006427,
        1.0000000372755184,1.0000000001484592,0.9999999821020266,1.0000000241029519,0.999999979864855,0.9999999734058486,0.9999999371729877,0.9999999900467307,1.0000000630555013,0.9999998888962532,0.9999999528563519,1.0000000313261792,0.9999999957590066,1.0000000778480618,0.9999999556996013,0.9999999463268382,
        1.0000000526438808,0.9999999537865426,0.9999999596688989,1.0000000262469595,0.9999999755140272,1.0000000138526774,1.0000000226210015,0.9999999706640358,1.0000000543339909,0.9999999798522194,0.9999999189934995,1.0000000277361134,1.0000000036021524,1.0000000045412236,1.00000002070909,1.000000031372263,
        1.0000000584386899,1.000000000940587,0.9999999352600194,0.9999999765274582,1.000000054058591,0.9999999878085359,1.0000000254875285,1.0000000544877887,0.9999999919008907,1.0000000169345378,0.9999999251940851,0.9999999940175112,1.000000045902538,0.9999998903699863,0.9999999356988397,1.0000000428341875,
        1.0000001192092924,1.0000000883945677,0.9999999927264464,1.0000000008293268,1.000000017575584,0.9999999835606815,0.9999999566247212,1.0000000297860503,1.0000000486727265,1.0000000400125997,1.0000000268774825,0.9999999968054445,1.0000000386345658,0.9999999655367797,0.9999999158656391,0.9999999910006427,
        1.0000000372755184,1.000000000148459,0.9999999821020266,1.0000000241029519,0.999999979864855,0.9999999734058486,0.9999999371729877,0.9999999900467307,1.0000000630555013,0.9999998888962534,0.9999999528563519,1.0000000313261792,0.9999999957590066,1.0000000778480618,0.9999999556996013,0.9999999463268375,
        1.0000000526438808,0.9999999537865433,0.9999999596688989,1.0000000262469597,0.9999999755140272,1.0000000138526774,1.0000000226210015,0.9999999706640357,1.0000000543339909,0.9999999798522193,0.9999999189934995,1.0000000277361134,1.0000000036021524,1.0000000045412236,1.00000002070909,1.0000000313722632,
        1.0000000584386899,1.000000000940587,0.9999999352600194,0.9999999765274581,1.000000054058591,0.9999999878085357,1.0000000254875285,1.0000000544877887,0.9999999919008907,1.0000000169345378,0.9999999251940851,0.9999999940175113,1.000000045902538,0.9999998903699864,0.9999999356988397,1.0000000428341875,
        1.0000001192092924,1.0000000883945677,0.9999999927264464,1.0000000008293268,1.000000017575584,0.9999999835606814,0.9999999566247212,1.0000000297860503,1.0000000486727265,1.0000000400126,1.0000000268774825,0.9999999968054446,1.0000000386345658,0.9999999655367797,0.9999999158656391,0.9999999910006426,
        1.0000000372755184,1.000000000148459,0.9999999821020266,1.0000000241029516,0.999999979864855,0.9999999734058485,0.9999999371729877,0.999999990046731,1.0000000630555013,0.9999998888962539,0.9999999528563519,1.0000000313261797,0.9999999957590066,1.0000000778480616,0.9999999556996013,0.9999999463268348,
        1.0000000526438808,0.9999999537865458,0.9999999596688989,1.00000002624696,0.9999999755140272,1.0000000138526772,1.0000000226210015,0.9999999706640353,1.0000000543339909,0.9999999798522191,0.9999999189934995,1.0000000277361134,1.0000000036021524,1.0000000045412238,1.00000002070909,1.0000000313722632,
        1.0000000584386899,1.000000000940587,0.9999999352600194,0.9999999765274581,1.000000054058591,0.9999999878085357,1.0000000254875285,1.0000000544877887,0.9999999919008907,1.0000000169345378,0.9999999251940851,0.9999999940175112,1.000000045902538,0.9999998903699863,0.9999999356988397,1.0000000428341875,
        1.0000001192092924,1.0000000883945677,0.9999999927264464,1.0000000008293268,1.000000017575584,0.9999999835606815,0.9999999566247212,1.0000000297860503,1.0000000486727265,1.0000000400125997,1.0000000268774825,0.9999999968054445,1.0000000386345658,0.9999999655367797,0.9999999158656391,0.9999999910006427,
        1.0000000372755184,1.000000000148459,0.9999999821020266,1.0000000241029519,0.999999979864855,0.9999999734058486,0.9999999371729877,0.9999999900467307,1.0000000630555013,0.9999998888962534,0.9999999528563519,1.000000031326179,0.9999999957590066,1.000000077848062,0.9999999556996013,0.9999999463268388
    };
    
    //-- Create the transformer.
    hriPhysio::Processing::HilbertTransform ht(num_samples);
    
    //-- Get the envelope.
    std::vector<double> target(num_samples);
    ht.process(source, target);

    //DEBUG.
    if (DEBUG) printVector(target);

    //-- Check the error with the expected.
    double err = absError(expected, target);
    std::cout << "Hilbert Transform Test 1 Error: " << err << std::endl;

    CHECK(err <= 0.001);
}


TEST_CASE("Test a complex sinusoidal wave (1 second of a 5, 12, and 20 Hz waves at 256 Hz sampling rate)") {

    std::size_t num_samples = 256;
    
    std::vector<double> source = {
        0.0,0.29469737,0.54334,0.7093634,0.7730519,0.7351287,0.6158115,0.44961515,0.27715653,0.13589357,0.0519497,0.034891505,0.076605946,0.1544409,0.23775905,0.29625234,
        0.30795982,0.26502264,0.17576939,0.06262366,-0.043657858,-0.11200998,-0.11937996,-0.057287276,0.06503012,0.22173373,0.37560263,0.48620534,0.5191581,0.45431796,0.29097903,0.04881661,
        -0.23570226,-0.51667595,-0.74825615,-0.894135,-0.9348998,-0.8716185,-0.7248903,-0.52964234,-0.3269284,-0.15466152,-0.039431453,0.00872467,-0.0025478601,-0.05105481,-0.10659999,-0.13929304,
        -0.12756114,-0.063897885,0.04305629,0.17061163,0.28779468,0.36337626,0.37419495,0.3117183,0.18519008,0.020512074,-0.14497481,-0.2706644,-0.3219459,-0.27840078,-0.13900286,0.07693273,
        0.33333334,0.5847203,0.78569037,0.90039593,0.90989345,0.815721,0.63894224,0.4149365,0.18519007,-0.011977415,-0.1496017,-0.21730877,-0.2224499,-0.18697244,-0.1408766,-0.11391059,
        -0.12756114,-0.18930574,-0.29053286,-0.40863892,-0.5127924,-0.5719604,-0.5632281,-0.47835723,-0.3269284,-0.13521793,0.059026707,0.21476679,0.29693955,0.2846618,0.17643708,-0.008888334,
        -0.23570226,-0.45897102,-0.6337142,-0.7244788,-0.71268123,-0.60018,-0.40831438,-0.17269067,0.06503012,0.26640844,0.40441668,0.46867505,0.4665867,0.42020777,0.35970232,0.31503534,
        0.30795982,0.34626505,0.42169192,0.512025,0.5868505,0.61557657,0.57574636,0.45958933,0.27715653,0.05519073,-0.16810553,-0.3512566,-0.45878744,-0.4694334,-0.38135323,-0.21309024,
        -1.1021821e-15,0.21309024,0.38135323,0.4694334,0.45878744,0.3512566,0.16810553,-0.05519073,-0.27715653,-0.45958933,-0.57574636,-0.61557657,-0.5868505,-0.512025,-0.42169192,-0.34626505,
        -0.30795982,-0.31503534,-0.35970232,-0.42020777,-0.4665867,-0.46867505,-0.40441668,-0.26640844,-0.06503012,0.17269067,0.40831438,0.60018,0.71268123,0.7244788,0.6337142,0.45897102,
        0.23570226,0.008888334,-0.17643708,-0.2846618,-0.29693955,-0.21476679,-0.059026707,0.13521793,0.3269284,0.47835723,0.5632281,0.5719604,0.5127924,0.40863892,0.29053286,0.18930574,
        0.12756114,0.11391059,0.1408766,0.18697244,0.2224499,0.21730877,0.1496017,0.011977415,-0.18519007,-0.4149365,-0.63894224,-0.815721,-0.90989345,-0.90039593,-0.78569037,-0.5847203,
        -0.33333334,-0.07693273,0.13900286,0.27840078,0.3219459,0.2706644,0.14497481,-0.020512074,-0.18519008,-0.3117183,-0.37419495,-0.36337626,-0.28779468,-0.17061163,-0.04305629,0.063897885,
        0.12756114,0.13929304,0.10659999,0.05105481,0.0025478601,-0.00872467,0.039431453,0.15466152,0.3269284,0.52964234,0.7248903,0.8716185,0.9348998,0.894135,0.74825615,0.51667595,
        0.23570226,-0.04881661,-0.29097903,-0.45431796,-0.5191581,-0.48620534,-0.37560263,-0.22173373,-0.06503012,0.057287276,0.11937996,0.11200998,0.043657858,-0.06262366,-0.17576939,-0.26502264,
        -0.30795982,-0.29625234,-0.23775905,-0.1544409,-0.076605946,-0.034891505,-0.0519497,-0.13589357,-0.27715653,-0.44961515,-0.6158115,-0.7351287,-0.7730519,-0.7093634,-0.54334,-0.29469737
    };

    std::vector<double> expected = {
        0.9999999466100974,0.9887203028719953,0.9552631012935477,0.9007611279585617,0.8270609209513129,0.7366635565552098,0.6326464016443966,0.5185732519893502,0.3984149170510476,0.27655546779379425,0.15836486847098857,0.0587205130807861,0.08328233685148127,0.16790431728284488,0.24162618230483118,0.29762323496647874,
        0.33333326371861843,0.34743870319266,0.33956476065870583,0.31029003682061373,0.2613424704516967,0.19642132686340594,0.12572354293622387,0.09376199984871386,0.15843683610412837,0.26421659593922325,0.3802123913051953,0.497084479547279,0.6093221704503494,0.7125073835615119,0.802842460927619,0.8770954893967938,
        0.9326441871000228,0.9675374673627998,0.9805513129713694,0.9712276468498208,0.9398937842100882,0.8876633606247352,0.8164209494864082,0.7288040253837832,0.6282072224419912,0.5188815968962931,0.40633442743551096,0.29872378605255345,0.21147976097519533,0.17497184461707108,0.20556858149666066,0.2685991091744432,
        0.3333332965855257,0.38694173531163517,0.42388434915139556,0.44158162474728935,0.4391689744081053,0.41719906440597154,0.3777838318468124,0.3252939366834969,0.268379649275405,0.22464783835529342,0.22198457880856082,0.27267616836659936,0.35824538984900417,0.45834169920048423,0.5608388117004782,0.6582684524922882,
        0.7453559629756534,0.8180793379035642,0.8733496113954694,0.9089178103105633,0.9233615621103634,0.9160973957510743,0.8873955568314594,0.8383954227628971,0.7711284483442691,0.6885808702576096,0.5948651077063805,0.4956726664426335,0.39940906938953513,0.3195782435227725,0.27636135950581064,0.28467200649943497,
        0.33333332709928293,0.3982669566656349,0.4623798163745168,0.5162455582337995,0.5546829876415728,0.5749005479492123,0.5757407532894052,0.5574240602718178,0.5215575779208275,0.47140019156046215,0.4125588235373938,0.3544578655790871,0.31230741911069465,0.304837011160693,0.34029229634040836,0.4079734927087334,
        0.4912085477353565,0.5772994259748233,0.6578173449668084,0.7270088744444487,0.7808091024855656,0.8163906231670526,0.8319774669674321,0.8267786524041196,0.8009771480593498,0.7557568405004983,0.6933820446211136,0.6173856701250872,0.5330075620240806,0.4481569770198416,0.3751656852819431,0.3317354923465982,
        0.33333326820493414,0.37707091844988244,0.44460129859684644,0.5185872979129047,0.5877592892971228,0.645211935593688,0.6866627151486838,0.709561112350705,0.7126936510715628,0.6960281899810931,0.6606864561642114,0.6090265630990184,0.5448912818385426,0.47417086638006245,0.4058965907069928,0.3535580080694054,
        0.33333327062109663,0.3535580359701388,0.4058965872247182,0.47417093597247456,0.5448913464368469,0.6090265064581841,0.6606864002049718,0.6960281925363209,0.7126936172020608,0.7095610666651707,0.6866627026973691,0.6452118772088995,0.5877592991733369,0.518587249361808,0.4446012583680458,0.37707095945240193,
        0.3333332613941272,0.331735497882949,0.37516566894056796,0.44815702748079594,0.5330075739753113,0.6173857209131896,0.6933820585117186,0.755756855667508,0.8009771274526953,0.8267786438882899,0.8319775146102109,0.8163906444265155,0.780809072151428,0.7270087883406923,0.6578173343900355,0.5772993882983126,
        0.4912085145894228,0.4079734912118823,0.3402922488121425,0.30483704615200014,0.31230746236856566,0.35445777318304367,0.41255875687419497,0.47140018721218524,0.5215575354858097,0.5574240562144707,0.5757407447254577,0.5749005057327475,0.5546829897024186,0.5162455228417716,0.46237980905993614,0.3982669883668495,
        0.33333334241443496,0.28467199490626777,0.27636131394533275,0.31957828438890423,0.39940907354704885,0.4956726688568311,0.5948651181426894,0.6885808999663652,0.7711283548520459,0.8383953733075034,0.8873955937190294,0.9160974050707854,0.9233615586334906,0.9089177341278467,0.873349593914185,0.8180793110831596,
        0.7453559332232769,0.6582684516503595,0.5608387763348839,0.4583417353148721,0.35824533568954187,0.27267603168394944,0.2219845416423233,0.2246478327277761,0.2683796217301439,0.32529396012486606,0.3777838373439729,0.41719905363642856,0.43916898052906006,0.44158158918920926,0.4238843133460425,0.3869417246068389,
        0.3333333656188077,0.2685991317579682,0.2055685157630904,0.17497184550214104,0.21147979453544857,0.29872378929173155,0.40633442496775546,0.5188816290503759,0.6282071061052453,0.728803933756845,0.8164209541801927,0.8876633540206837,0.9398937839561273,0.9712275670384684,0.9805512801911775,0.9675374514443342,
        0.932644150547034,0.877095490804038,0.8028424284432842,0.7125074113399181,0.6093221089370939,0.497084375042656,0.3802123995805311,0.2642166301435883,0.15843691234451135,0.09376205321323854,0.12572353029003686,0.19642132476419408,0.261342504448227,0.31029003752520734,0.3395647189986608,0.34743862550566895,
        0.33333330546769063,0.2976232883074704,0.24162620063350937,0.16790431167727551,0.08328230641183784,0.05872053947438217,0.1583648878200058,0.2765555045035943,0.39841479888272463,0.5185731712925467,0.6326463994605229,0.7366635965400686,0.8270609402049416,0.9007610810676878,0.9552630935657358,0.9887202959696385
    };
    
    //-- Create the transformer.
    hriPhysio::Processing::HilbertTransform ht(num_samples);
    
    //-- Get the envelope.
    std::vector<double> target(num_samples);
    ht.process(source, target);

    //DEBUG.
    if (DEBUG) printVector(target);

    //-- Check the error with the expected.
    double err = absError(expected, target);
    std::cout << "Hilbert Transform Test 2 Error: " << err << std::endl;

    CHECK(err <= 0.001);
}


TEST_CASE("Test a complex amplitude modulated sinusoidal wave (1 second of a 5, 22, and 47 Hz waves, modulated at 20 Hz, at 256 Hz sampling rate)") {

    std::size_t num_samples = 256;
    
    std::vector<double> source = {
        0.0,0.7605763788857582,1.139084109211599,0.6949951649280827,0.19731412860490952,0.27810019525998547,0.46578293153445505,0.2690321567297154,0.010024799077860013,-0.013112199631807694,-0.004414229507441878,0.0575965469082863,0.44183721891046707,0.850754809131324,0.787409834224504,0.5859728991250062,
        0.8322018980979919,1.130788596793757,0.7541751429390373,0.020811284577442732,-0.2527527039033293,-0.09040940020845062,0.00023148608415060411,0.016538197697507594,0.11064958147323639,0.08085419302195464,-0.017153317933286186,0.2540471983017087,0.6658521309407428,0.3571717610365694,-0.6315927277855078,-1.180037096940575,
        -0.8047378659248358,-0.22662631842425363,-0.018556878440298366,-0.0006669647461866857,-0.026280930215453847,-0.12736086038322217,-0.040337029382107675,0.27989313240556524,0.13279455111851737,-0.8266249489271963,-1.656209744579214,-1.41937123119249,-0.5910505752047215,-0.13024670178910597,-0.08134458701944297,-0.038342727065307905,
        -0.0,0.026716384638376233,0.25394705700089276,0.42219609051486223,0.0013010067677883099,-0.6561723956859689,-0.6273961261965214,0.023641770724590446,0.3485206393250885,0.11895340796055953,-0.04300191202687252,0.045707284421673815,0.045961737809183716,0.0046247752785414445,0.14176278876363824,0.19405748901745526,
        0.0,0.035870443901101993,0.46377017863811554,0.5877319091379695,0.09521205472007906,-0.26153411755345535,0.014245779888073944,0.34728106030882333,0.2401953943341836,0.02891594140018458,0.003816027166126812,-0.03302610396622869,-0.07970746889340495,0.022366092777537466,-0.10353954310494581,-0.7912131932825411,
        -1.3424464464187622,-0.9159470607101927,0.0163206369233257,0.3838305861321014,0.13975462226936072,-0.039234469555439626,-0.007939697193058103,-0.013976586174798569,-0.05193963675195039,-0.22607849805536578,-0.8527808132754098,-1.5543314503148764,-1.376794729736093,-0.341619611083973,0.3739028291322344,0.210545703337995,
        -0.13807117938995436,-0.12166610647449846,-0.0051555516796094525,0.0007044990415607171,-0.0018483177064223092,-0.16350711401600448,-0.545575551676761,-0.5439154369492867,0.2093920959063098,0.9430429702589497,0.8615944351287611,0.40672583972006043,0.33795423722049195,0.4626458746710494,0.30147688014941615,0.05182268365370912,
        -0.0,-0.0395939253778632,-0.05856383483746866,0.29504241839713596,0.8098076536222968,0.8480915691825016,0.5657294083978653,0.6945937728164115,1.1098694722411577,1.0015233456287338,0.3663077976248256,-0.042001521692887366,-0.03438761252801751,-0.0015289811409317398,0.0057305953961478565,0.09206818639463793,
        -4.696542312091486e-15,-0.25627694428735287,-0.06227607656897428,0.6335257859908733,0.869117414766141,0.1877618818420023,-0.5438758109071284,-0.5508834422435895,-0.1904234965088445,-0.015283539366969877,-0.0054878901098248415,-0.10857686734474914,-0.36154890517744426,-0.35916606291466285,0.204982125350442,0.6310420728711911,
        0.11060712486505508,-0.825942197003488,-1.0552138842777756,-0.5631959574899028,-0.150883958580292,-0.052071048869799304,-0.00835794552843542,-0.020750307481528226,-0.03592600395006704,0.29917825630708667,0.8100437596559432,0.7309355038772128,0.046714644855423426,-0.2919056992177931,0.05602690627408211,0.33866440962543376,
        0.13807117938995356,-0.07563911421457219,-0.034406243123854444,0.0008244809513206637,0.054474439117663385,0.347697229532832,0.5743595418347652,0.41101778776464437,0.3027263876945364,0.6351964351417293,0.8184785238037996,0.30645959553855506,-0.3130264291279639,-0.3153034656676745,-0.004662841131078603,0.0574699233710784,
        0.0,0.049643656864708015,0.02958147053641173,-0.01837296667070477,0.17853108510744897,0.25796618581534064,-0.39338229226899263,-1.3141480091384532,-1.399961351576468,-0.6313678406768968,-0.009594727604349254,0.05850405206896565,-0.003767172524774742,-0.001418460029358547,-0.042675765671119394,-0.012886554131229293,
        0.0,-0.5401698702774357,-1.5405781908124687,-1.9162528005957862,-1.1616435049200045,-0.204327971725712,0.06384712508393288,-0.06542979065832881,-0.05979668817430084,-0.0005202032435577892,0.006086091592174369,0.08400642778509766,-0.0005808509840803543,-0.5139549371645773,-0.8888524396497974,-0.42580175067084264,
        0.39963746070861816,0.6111006609199212,0.28471814353132213,0.15855413382032976,0.2638820310155258,0.18171490848646943,0.01606615626154716,0.01818869595882,-0.022783942953442594,-0.1539539671370493,0.05989043833363229,0.5693487724903136,0.6642279718574524,0.2763535492651963,0.2016630913091522,0.6308270278281882,
        0.8047378659248414,0.42393152335972784,0.05811866414030492,-0.0008620152466948857,-0.026345191904714137,-0.056829260581576085,0.0115529942462793,-0.14699545438080858,-0.6449130220004284,-0.7516144564734825,-0.02386317561359473,0.7061858751936206,0.566122787715786,-0.017095745855973725,-0.21546946317440055,-0.07094987995948218,
        -0.0,-0.03676611788472925,-0.22496468607731357,-0.6988654615977461,-0.98963973173498,-0.44988538573178855,0.45504909861565035,0.5959125038708486,-0.05842881086553001,-0.4891088840722906,-0.313711175235113,-0.062209812073769105,-0.007806956442812282,-0.0016773342517571795,-0.10481762037214307,-0.2732391242346643
    };

    std::vector<double> expected = {
        1.0000000102520308,1.2454621635903396,1.1653752965004813,0.7743079391036942,0.2706819276377476,0.29750638972904603,0.46835789984041154,0.37809175143963647,0.1442548451504321,0.0587635884556316,0.18093518230308409,0.429573165712161,0.7456948191850659,0.9080685045920325,0.7928797713586022,0.5906888680235912,
        0.8323745781929688,1.2189709311082637,1.3271696580598542,1.0811087969323994,0.6420273261691714,0.3351354749667498,0.317969774885484,0.2700122955518142,0.2935736829295405,0.3766871917457884,0.25205925657570566,0.2664496297552487,0.822229857791153,1.3046204798985823,1.4803577130479226,1.2857626804826892,
        0.8385455123150573,0.3615099769821956,0.04389106461433354,0.1050436895212143,0.2189297956642849,0.2596377919726913,0.11135237847921556,0.42491104736675844,1.0167123207738966,1.519752761850067,1.7214746511983023,1.5504009039452615,1.1153856401020097,0.6628712697646681,0.44265695117002074,0.38045623052588706,
        0.30795982702168956,0.32934624364897913,0.4002669939301665,0.43254836423162507,0.5311750784579605,0.7047921323876153,0.791911234126563,0.6922474695448786,0.43064213807801177,0.12271123216512518,0.09866250911546653,0.1582505200484086,0.09573590243858554,0.1511011517967423,0.23908915586479532,0.19512148049622285,
        4.225288230408353e-09,0.28096064729459724,0.5332548195898167,0.6449040806884614,0.5597106030288019,0.3167222312063467,0.16826317994995735,0.3495670535416739,0.42589274373410196,0.3562629720416492,0.30152109683203016,0.34247628023870536,0.3166458692323028,0.37417036888378696,0.7497928807763623,1.15240287054261,
        1.3455732025290674,1.2350473608063868,0.8819257706189163,0.4636256259597813,0.18082141184662692,0.09345014967337294,0.08748765348896237,0.19699079744880763,0.3361981845783319,0.6506673542667017,1.1312363728311892,1.5581670688961298,1.7037744822894076,1.46368418887007,0.9182333254228063,0.31283512618111775,
        0.2731651733904919,0.4338801444117281,0.3877161723633197,0.31709606052390804,0.24476400501495565,0.19979201684600442,0.6244673308169801,1.1168644361892528,1.3876570191394555,1.290262005375253,0.8734530040128273,0.4067453508583782,0.3875311573026726,0.4708528647406213,0.322989269493159,0.06492166371790681,
        0.12756113475311415,0.23320082798469766,0.5034086246234794,0.8435284917793623,1.0031523018520403,0.8543461714114514,0.5664395708164982,0.7332772898030364,1.1106201784901957,1.2279376278737688,1.0172890412517908,0.6384845933833703,0.3673285155676233,0.29779758627488206,0.21421530084024226,0.2339868065787841,
        0.33333333080262895,0.2943957169605096,0.33525647912095924,0.6910782308394645,1.016551083292774,1.1067162871596736,0.9214702025038038,0.5626310495854648,0.2026013985290784,0.055226821078812924,0.17284202703301635,0.30331352937620537,0.4117664776315302,0.4237623390308268,0.44414352870584944,0.6717716226443005,
        0.9661154379385753,1.1236289759602485,1.0599105817575654,0.8151608959306684,0.5317497818720129,0.3773010016361708,0.32797832741251254,0.29862287243820324,0.4537462926563193,0.715327870045664,0.8745203527495152,0.8263713818110074,0.5859039728270936,0.3010768083207993,0.2679756599037188,0.3387227536746189,
        0.27316516133628993,0.12577154271657895,0.06856879345965414,0.10825102259955278,0.26519636260986473,0.47968830521912637,0.5766364553374782,0.45395351453746696,0.30582694280504463,0.6353788961478858,0.9868123536798205,1.0669662689359605,0.8275625678332417,0.3999929880180005,0.15166181383386013,0.30757591592530953,
        0.307959824312544,0.3130943942083104,0.3965062919201575,0.3519632983923198,0.4134373362062734,0.8937166010734231,1.3782781146126666,1.5833997646287747,1.4118152444796843,0.9584012379888623,0.4453276690020679,0.090334624239431,0.05591496865564253,0.1508794938652415,0.24917259849977327,0.32287171184142616,
        0.6666666771734632,1.2434870117349504,1.7541154395939587,1.944584504942606,1.716803494445559,1.1814277846078942,0.6284828454342986,0.4250113172566364,0.43059283115439484,0.3508758139535401,0.29343361087968545,0.21545190220681293,0.09718886948191037,0.5409910222883094,0.9924935212797675,1.2194636180004057,
        1.1089962441335963,0.7241557815666043,0.3054514529714011,0.2806287486377634,0.32813009803035476,0.18483802754955614,0.07887805066670733,0.16907980678274315,0.15346387396046687,0.3625846656312423,0.6678747627216874,0.8092754108908483,0.6671897583841406,0.29214151450531206,0.31206233187276755,0.6873341018790928,
        0.8385455255273117,0.7327316251943199,0.4902262177948456,0.32030276515077,0.2881584327484163,0.2262779395830339,0.2514891312687101,0.48582741630742204,0.7200849162330338,0.8561262936061875,0.877662496505882,0.8087704374961641,0.676026979861378,0.4916488110125646,0.2729927372624822,0.0801360959278761,
        0.12756112328070396,0.2516425613080665,0.47115928169966387,0.7792488873169037,1.03766378181371,1.1054119940714593,0.9285251940586617,0.5975048594139561,0.3989942334459538,0.4895002030518901,0.5202521913505072,0.4213826275442896,0.33761211428405935,0.29764086894584135,0.2869321704981686,0.5850976606200673
    };
    
    //-- Create the transformer.
    hriPhysio::Processing::HilbertTransform ht(num_samples);
    
    //-- Get the envelope.
    std::vector<double> target(num_samples);
    ht.process(source, target);

    //DEBUG.
    if (DEBUG) printVector(target);

    //-- Check the error with the expected.
    double err = absError(expected, target);
    std::cout << "Hilbert Transform Test 3 Error: " << err << std::endl;

    CHECK(err <= 0.001);
}
